<!DOCTYPE html>
<html lang="zh">
<head>

	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<base href="https://scottpetrovic.github.io/krita-hugo/">

	<title>Krita | Krita 2018 年度 Google Summer of Code 工作报告 | Krita Site(PRC)</title>

	<link href="css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
	<link rel="stylesheet" href="/css/style.css" type="text/css" media="all" />

	<link href="images/favicon.ico" rel="shortcut icon" type=image/vnd.microsoft.icon>

	<link rel="alternate" type="application/rss+xml" href="/index.xml" title="Site Title">

	<script src="js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>  
		
	
</head>

<body>

<header class="site-header"><nav class="site-nav max-content-width">
   <a class="logo" href="https://scottpetrovic.github.io/krita-hugo//zh">
      <img src="images/krita-logo.png" style="width: 7.5rem" />
    </a>

    <ul class="main-menu">
      

      <li class="donate-button">
        <a href="https://fund.krita.org" class="button">Donate</a>
      </li>

     

  </ul>
  </nav>
</header>


<main class="content">


<div class="post">
    <h1 style="margin-bottom: 0.5rem">Krita 2018 年度 Google Summer of Code 工作报告</h1>

    <div style="text-align: center; margin-bottom: 2rem;">
        <span>2018年9月6日</span> 
        <span class="vertical-divider">|</span>
        <span> Reading time: <em>2 min</em></span> 
        
        
    </div>

    <p>今年的 Google Summer of Code 活动中有三位学生参加了 Krita 的项目，他们是 <a href="https://colorathis.wordpress.com/">Ivan</a>, <a href="https://lieroz.github.io/">Andrey</a> 和 <a href="https://simeir.github.io/">Michael</a>。他们贡献的代码有一部分已被应用到了 Krita 4.1.1，余下的绝大部分代码也已经整合到了主分支，你可以通过 <a href="https://binary-factory.kde.org/job/Krita_Nightly_Windows_Build/">Windows</a> 或者 <a href="https://binary-factory.kde.org/job/Krita_Nightly_Appimage_Build/">Linux</a> 的每夜更新版本进行测试。下面我们将介绍他们在今年 GSoC 中的工作成果。</p>
<p><strong>Ivan</strong> 负责的工程是通过矢量化来提高笔刷绘制速度。它的原理是利用 CPU 的一项特性——只要运算方式保持不变，仅改变输入的数据，CPU 在同一时间内能够处理大量的数据。例如我们提供 200 个数字给 CPU，然后告诉 CPU 对这些数字全部进行乘法运算，CPU 处理这组运算所需的时间和单个数字的乘法运算所需时间相同。笔刷绘制在本质上和前面的例子是一样的，但想要实现相同的处理逻辑需要克服一些困难。Ivan 已经在预制笔刷引擎中实现了这个目标。我们借用他<a href="https://colorathis.wordpress.com/">博客</a>上的一则演示动图来说明他的工程带来的速度提升：</p>
<p><a href="images/posts/2018/avx_cgauss_60.gif"><img src="images/posts/2018/avx_cgauss_60.gif" alt=""></a></p>
<p>上半部分是以前的处理速度，下半部分是现在的处理速度。</p>
<p><strong>Andrey</strong> 的项目也是与性能有关。现代 CPU 通常具备多个核心——例如四核心八线程、十核心 20 线程，甚至更多。但许多程序只能利用一个核心，造成了大量的浪费。Krita 对多核心的利用由来已久，其中就包括它的分块引擎。该引擎在 2009 年的 <a href="http://dimula73.blogspot.com/2009/08/gsoc-krita-tile-engine-wrap-up.html">GSoC</a> 项目中由 Dmitry Kazakov 开发，它可以把一张完整的图像分割成多个小块，分别交给不同的 CPU 进程并行处理，这样可以增加 CPU 的利用率以提升性能。九年后的今天 Dmitry 又指导了 Andrey 进一步改进了该引擎。</p>
<p>去年 Dmitry 在改进 Krita 的多核心支持时发现了一个问题：Krita 在某些情况下会强制多个核心相互等待。Andrey 的工程就是要在分块引擎中解决这个问题。现在这项工作已经大致完成，其中一部分改进已经整合到了 Krita 4.1.1，但余下的部分有一些相当棘手的 bug，需要进行深入测试后留待年底的 Krita 4.2 中整合。下表列出了该工程带来的性能提升幅度：</p>
<p><a href="images/posts/2018/lockless.png"><img src="images/posts/2018/lockless-1024x506.png" alt=""></a></p>
<p><strong>Michael</strong> 的工程是改进 Krita 的调色板系统。调色板是包含有一组预制颜色的资源，用于快速选取颜色。Krita 的调色板的编辑功能原本是和 Calligra 的其他组件共享代码的，这个传统甚至可以追溯到 KOffice 的时代。也是因为这个原因，相关的代码分散在项目的各个角落，关系错综复杂。Micheal 的第一阶段的工作就是重新组织这些代码，让它们变得集中而有条理。Krita 4.1.1 已经整合了这项改进。</p>
<p>Michael 的下一个工程是改进调色板工具面板，详情可参考 <a href="https://phabricator.kde.org/D14815">他为此建立的 Phabricator 任务</a>。这项工作还未结束，但 GSoC 计划内的部分已经完成了。下面我们预览一下新调色板工具面板的草案：</p>
<p><a href="images/posts/2018/listanddocker.jpg"><img src="images/posts/2018/listanddocker-1024x512.jpg" alt=""></a></p>
<p>新调色板编辑对话框草案：</p>
<p><a href="images/posts/2018/DlgPaletteEditor.png"><img src="images/posts/2018/DlgPaletteEditor-1024x517.png" alt=""></a></p>

</div>


</main>


<style>

	footer {
		margin-top: 5rem;
		text-align: center;
		background: #324148;
		padding: 1rem;
	}

	footer p {
		color: #a8a5a5;
	}

	footer a {
		display: block;
		text-align: left;
		color: #91b3c3;
		text-decoration: none;
	}
	footer a:hover {
		text-decoration: underline;
		color: #91b3c3; 
	}

	footer h4 {
		text-align: left;
		color: white;
	}
</style>




   



<footer>

<div  class="container-padding">

	<div class="row">
		<div class="col-md-3">
			<h4>Software</h4>
			<a href="https://scottpetrovic.github.io/krita-hugo/zh/report-a-bug">Report a Bug</a>	
			<a href="https://scottpetrovic.github.io/krita-hugo/zh/roadmap">Roadmap</a>
			<a href="https://scottpetrovic.github.io/krita-hugo/zh/release-history">Release History</a>	

		</div>
		<div class="col-md-3">
			<h4>Education</h4>
			<a href="https://docs.krita.org/zh/">Documentation</a>
			<a href="https://docs.krita.org/KritaFAQ.html">FAQ</a>
			<a href="https://scottpetrovic.github.io/krita-hugo/zh/privacy-statement">Privacy Statement</a>	
			<a href="https://docs.krita.org/zh/tutorials.html">Tutorials</a>

		</div>
		<div class="col-md-4">
			<h4>Foundation</h4>
			<a href="https://scottpetrovic.github.io/krita-hugo/zh/about">About</a>
			<a href="https://scottpetrovic.github.io/krita-hugo/zh/donations">Donations</a>
			<a href="https://scottpetrovic.github.io/krita-hugo/zh/get-involved">Get Involved</a>
			
			<a href="https://userbase.kde.org/What_is_KDE/zh">What is KDE</a>
			<a href="https://scottpetrovic.github.io/krita-hugo/zh/website">Website Licenses</a>
			<a href="https://scottpetrovic.github.io/krita-hugo/zh/contact">Contact</a>


		</div>

		<div class="col-md-2">
			<select onchange="languageSwitched(this)" >
				<option value="">Language</option>
				
					<option value="https://scottpetrovic.github.io/krita-hugo/">English</option>
				
					<option value="https://scottpetrovic.github.io/krita-hugo/fr/">French</option>
				
					<option value="https://scottpetrovic.github.io/krita-hugo/zh/">Chinese</option>
				
					<option value="https://scottpetrovic.github.io/krita-hugo/zh-hk/">Chinese (HK)</option>
				
					<option value="https://scottpetrovic.github.io/krita-hugo/zh-tw/">Chinese (TW)</option>
				
					<option value="https://scottpetrovic.github.io/krita-hugo/jp/">Japanese</option>
				
					<option value="https://scottpetrovic.github.io/krita-hugo/es/">Spanish</option>
				
					<option value="https://scottpetrovic.github.io/krita-hugo/ko/">Korean</option>
				
			</select>
			
		</div>
	</div>

</div>




<style>
	select {
		background: none;
		border: 1px solid grey;
		padding: 0.25rem;
		border-radius: 3px;
		color: white;
	}
</style>

<script>
	function languageSwitched (selectedObject) {
		location.href = selectedObject.value; 
	};
</script>




</footer>

</body>
</html>

